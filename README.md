# jlog 日志处理
jlog 是刚刚开发的一个PHP扩展，用来处理日志。 目前功能还是比较单一，仅仅是将日志信息写入文件。
不同的是该扩展并不是直接将日志内容写入文件，而是先将日志内容存入内存，然后由一个线程再将日志写入文件。这样我们的主线程在将日志内容存入内存之后就可以继续去处理其他的事情，这样就节省了I/O的访问时间。
***
#### 一、 配置项
在 php.ini 中可以配置一个配置项 `enable_thread` 表示是否开启线程。
```vim
[jlog]
jlog.enable_thread = 1/0   1 开启线程； 0 表示不开启线程
``` 
如果没有该配置项，则程序中硬编码为1：开启线程。 具体应用程序中是否开启线程，还要根据函数 `jlog_start()` 的参数而定。

#### 二、 函数
该扩展目前包含四个函数

* `jlog_start([boolean $enable_thread])`
* `jlog_stop()`
* `jlog_info($file,$message)`
* `jlog_error($file,$message)`

1. `jlog_start()` 函数主要作用是开启一个线程，该线程负责将内存的日志写入文件。

参数： $enable_thread 表示是否开启线程。 如果缺省，则按照配置文件中的配置项执行，配置项中如果开启则开启，否则就是关闭； 如果该参数为`true` 则不论配置项的值是什么，都开启线程； 反之该参数为`false`，则不论配置项中的值是什么，则都关闭线程。

2. `jlog_stop()` 监控如果相应的存放日志的内存空了，就关掉由 `jlog_start()` 开启的线程，并且回收相关内存。
    在调用 `jlog_stop()` 之前必须要保证前面已经调用了`jlog_start()`。 
> 要调用`jlog_stop()` 必须先 `jlog_start()` 。然而反过来却不需要，因为如果没有调用`jlog_stop()` 的话，PHP会在生命周期的最后对结束线程并进行回收释放。当然前提是
> 存放日志的内存已经空了，从而保证日志不丢失。

3. `jlog_info()` 和 `jlog_error()`  将日志存入内存或者直接写入文件。
   这两个函数基本上没什么区别，不同的是日志级别不同。 如果前面没有调用`jlog_start()` 开启线程，那么这两个函数不再将日志存入相关内存，而是直接将日志写入文件。
   
> 整个扩展基本上就是这样一个功能，还比较初级，随着业务的增长需要会继续更新该扩展。同时也是为了深入对PHP的扩展和C语言的开发进行学习。

